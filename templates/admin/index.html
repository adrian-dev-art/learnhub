{% extends "unfold/layouts/base.html" %}
{% load i18n static admin_dashboard_tags unfold %}

{% block breadcrumbs %}{% endblock %}

{% block content %}
{% get_admin_stats as stats %}

<div class="px-4 py-8 md:px-8">
  <div class="mb-8">
    <h1 class="text-2xl font-bold text-gray-900 dark:text-white">GampangBelajar Analytics</h1>
    <p class="text-gray-600 dark:text-gray-400">Welcome back to the administration dashboard.</p>
  </div>

  <!-- Summary Cards -->
  <div class="grid grid-cols-1 md:grid-cols-3 gap-6 mb-8">
    {% component "unfold/components/card.html" with title="Total Revenue" %}
    <div class="text-3xl font-bold text-emerald-600 dark:text-emerald-400">Rp {{ stats.total_revenue }}</div>
    {% endcomponent %}

    {% component "unfold/components/card.html" with title="Total Users" %}
    <div class="text-3xl font-bold text-blue-600 dark:text-blue-400">{{ stats.total_users }}</div>
    {% endcomponent %}

    {% component "unfold/components/card.html" with title="Total Courses" %}
    <div class="text-3xl font-bold text-purple-600 dark:text-purple-400">{{ stats.total_courses }}</div>
    {% endcomponent %}
  </div>

  <!-- Charts -->
  <div class="grid grid-cols-1 lg:grid-cols-2 gap-6 mb-8">
    {% component "unfold/components/card.html" with title="User Distribution" %}
    {% component "unfold/components/chart/bar.html" with component_class="UserDistributionChart" %}{% endcomponent %}
    {% endcomponent %}

    {% component "unfold/components/card.html" with title="Top Courses" %}
    {% component "unfold/components/chart/bar.html" with component_class="CoursePerformanceChart" %}{% endcomponent %}
    {% endcomponent %}
  </div>

  <!-- Recent Activity & App List -->
  <div class="grid grid-cols-1 lg:grid-cols-3 gap-6">
    <div class="lg:col-span-2">
      {% component "unfold/components/card.html" with title="Recent Enrollments" %}
      <div class="divide-y divide-gray-100 dark:divide-gray-700 -mx-6 -mb-6">
        {% for enrollment in stats.recent_enrollments %}
        <div class="p-4 flex justify-between items-center hover:bg-gray-50 dark:hover:bg-gray-700/50 transition-colors">
          <div>
            <div class="font-medium text-gray-900 dark:text-white">{{ enrollment.user.username }}</div>
            <div class="text-sm text-gray-500 dark:text-gray-400">{{ enrollment.course.title }}</div>
          </div>
          <div class="text-right">
            <div class="text-sm text-gray-500 dark:text-gray-400">{{ enrollment.enrolled_at|date:"M d, Y" }}</div>
            <div
              class="text-xs font-medium text-emerald-600 dark:text-emerald-400 bg-emerald-50 dark:bg-emerald-900/20 px-2 py-1 rounded-full inline-block mt-1">
              Paid</div>
          </div>
        </div>
        {% empty %}
        <div class="p-8 text-center text-gray-500 dark:text-gray-400">
          No recent activity.
        </div>
        {% endfor %}
      </div>
      {% endcomponent %}
    </div>

    <div class="lg:col-span-1">
      {% component "unfold/components/card.html" with title="Quick Links" %}
      <div class="space-y-3">
        <a href="{% url 'admin:core_course_changelist' %}"
          class="flex items-center p-3 rounded-lg hover:bg-gray-50 dark:hover:bg-gray-700 transition-colors border border-gray-100 dark:border-gray-700">
          <span
            class="w-8 h-8 flex items-center justify-center bg-purple-100 dark:bg-purple-900/30 text-purple-600 dark:text-purple-400 rounded-lg mr-3">
            <i class="material-symbols-outlined text-sm">school</i>
          </span>
          <span class="text-sm font-medium text-gray-700 dark:text-gray-300">Manage Courses</span>
        </a>
        <a href="{% url 'admin:core_user_changelist' %}"
          class="flex items-center p-3 rounded-lg hover:bg-gray-50 dark:hover:bg-gray-700 transition-colors border border-gray-100 dark:border-gray-700">
          <span
            class="w-8 h-8 flex items-center justify-center bg-blue-100 dark:bg-blue-900/30 text-blue-600 dark:text-blue-400 rounded-lg mr-3">
            <i class="material-symbols-outlined text-sm">person</i>
          </span>
          <span class="text-sm font-medium text-gray-700 dark:text-gray-300">Manage Users</span>
        </a>
        <a href="{% url 'admin:core_enrollment_changelist' %}"
          class="flex items-center p-3 rounded-lg hover:bg-gray-50 dark:hover:bg-gray-700 transition-colors border border-gray-100 dark:border-gray-700">
          <span
            class="w-8 h-8 flex items-center justify-center bg-emerald-100 dark:bg-emerald-900/30 text-emerald-600 dark:text-emerald-400 rounded-lg mr-3">
            <i class="material-symbols-outlined text-sm">payments</i>
          </span>
          <span class="text-sm font-medium text-gray-700 dark:text-gray-300">Enrollments</span>
        </a>
      </div>
      {% endcomponent %}
    </div>
  </div>
</div>
{% endblock %}
