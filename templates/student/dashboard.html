{% extends 'shared/base.html' %}
{% load static %}

{% block title %}Dashboard - GampangBelajar{% endblock %}
{% block page_title %}Dashboard{% endblock %}

{% block content %}
<div class="container">
  <!-- Welcome Header -->
  <div class="dashboard-section" style="margin-bottom: var(--spacing-2xl);">
    <h1
      style="font-size: var(--font-size-3xl); font-weight: 800; color: var(--text-main); margin-bottom: var(--spacing-xs);">
      Welcome back, {{ user.first_name|default:user.username }}! ðŸ‘‹
    </h1>
    <p style="color: var(--text-muted); font-size: var(--font-size-lg);">
      Ready to continue your learning journey?
    </p>
  </div>

  <!-- Stats Overview -->
  <div class="grid grid-3 dashboard-section">
    <div class="stat-card">
      <div class="stat-icon" style="background: rgba(212, 175, 55, 0.15); color: #D4AF37;">
        <span class="material-icons">menu_book</span>
      </div>
      <div class="stat-info">
        <h3>{{ enrollments.count }}</h3>
        <p>Enrolled Courses</p>
      </div>
    </div>
    <div class="stat-card">
      <div class="stat-icon" style="background: rgba(16, 185, 129, 0.15); color: #10b981;">
        <span class="material-icons">check_circle</span>
      </div>
      <div class="stat-info">
        <h3>{{ enrollments|dictsort:"completed"|last|default:"0" }}</h3>
        <p>Completed</p>
      </div>
    </div>
    <div class="stat-card">
      <div class="stat-icon" style="background: rgba(245, 158, 11, 0.15); color: #f59e0b;">
        <span class="material-icons">stars</span>
      </div>
      <div class="stat-info">
        <h3>{{ user.certificates_set.count|default:"0" }}</h3>
        <p>Certificates</p>
      </div>
    </div>
  </div>

  <!-- Continue Learning -->
  {% if enrollments %}
  <div class="dashboard-section">
    <div class="section-header-flex">
      <h2>Continue Learning</h2>
      <a href="{% url 'catalog' %}" style="color: var(--primary); font-weight: 600; text-decoration: none;">View All</a>
    </div>
    <div class="grid grid-2">
      {% for enrollment in enrollments %}
      <a href="{% url 'course_viewer' enrollment.id %}" class="course-card-horizontal">
        {% if enrollment.course.thumbnail %}
        <img src="{{ enrollment.course.thumbnail.url }}" alt="{{ enrollment.course.title }}" class="course-img">
        {% else %}
        <div class="course-img"
          style="background: rgba(212, 175, 55, 0.1); display: flex; align-items: center; justify-content: center;">
          <span class="material-icons" style="color: var(--primary); font-size: 40px;">school</span>
        </div>
        {% endif %}
        <div class="course-content">
          <h3 class="course-title">{{ enrollment.course.title }}</h3>
          <div class="course-meta">
            <span>{{ enrollment.course.modules.count }} Modules</span>
            <span>â€¢</span>
            <span>{{ enrollment.course.get_level_display }}</span>
          </div>
          <div class="progress-container">
            <div class="progress-bar" style="width: {{ enrollment.progress_percentage }}%;"></div>
          </div>
          <div style="display: flex; justify-content: space-between; align-items: center; margin-top: 4px;">
            <span style="font-size: 12px; color: var(--gray-500);">{{ enrollment.progress_percentage }}% Complete</span>
            <span style="font-size: 14px; font-weight: 600; color: var(--primary);">Resume <span class="material-icons"
                style="font-size: 14px; vertical-align: middle;">play_arrow</span></span>
          </div>
        </div>
      </a>
      {% endfor %}
    </div>
  </div>
  {% endif %}

</div>
{% endblock %}
