{% extends 'shared/base.html' %}
{% load admin_dashboard_tags %}

{% block title %}{{ course.title }} - GampangBelajar{% endblock %}

{% block content %}
<div class="container" style="padding-top: var(--spacing-xl);">
  <div class="course-detail-grid">
    <!-- Main Content -->
    <div class="course-main-content">
      <!-- Hero Card -->
      <div class="course-hero-card">
        {% if course.thumbnail %}
        <img src="{{ course.thumbnail.url }}" alt="{{ course.title }}" class="course-hero-thumbnail">
        {% else %}
        <div class="thumbnail-placeholder"
          style="aspect-ratio: 16/9; display: flex; align-items: center; justify-content: center; background: #0f172a; color: var(--text-muted);">
          <span class="material-icons" style="font-size: 64px;">school</span>
        </div>
        {% endif %}
      </div>

      <!-- Title & Mentor Section -->
      <div class="course-title-section">
        <h1>{{ course.title }}</h1>
        <div class="mentor-info-bar">
          <div class="mentor-profile">
            <div class="mentor-avatar">
              {% if course.mentor.first_name %}
              {{ course.mentor.first_name|first }}{{ course.mentor.last_name|first }}
              {% else %}
              <span class="material-icons">person</span>
              {% endif %}
            </div>
            <div class="mentor-meta">
              <span class="mentor-name">{{ course.mentor.get_full_name|default:course.mentor.username }}</span>
              <span class="mentor-followers">Mentor â€¢ 3560k Followers</span>
            </div>
            <button class="btn btn-secondary btn-sm"
              style="margin-left: var(--spacing-md); border-radius: var(--radius-full); background: #334155; color: white; border: 1px solid #475569;">Follow</button>
          </div>

          <div class="course-stats-bar">
            <div class="stat-item">
              <span class="material-icons">group</span>
              <span>5000</span>
            </div>
            <div class="stat-item">
              <span class="material-icons">play_circle</span>
              <span>{{ modules|length }}</span>
            </div>
            <div class="stat-item">
              <span class="material-icons">chat</span>
              <span>8</span>
            </div>
            <div class="stat-item">
              <span class="material-icons">folder</span>
              <span>12</span>
            </div>
          </div>
        </div>

        <!-- Tabs -->
        <div class="course-tabs">
          <div class="tab-item active">Description</div>
          <div class="tab-item">Reviews <span class="badge badge-primary"
              style="background: rgba(212, 175, 55, 0.1); color: var(--primary); font-size: 10px; padding: 2px 6px; margin-left: 4px;">1255</span>
          </div>
          <div class="tab-item">Discussions <span class="badge badge-primary"
              style="background: rgba(212, 175, 55, 0.1); color: var(--primary); font-size: 10px; padding: 2px 6px; margin-left: 4px;">1255</span>
          </div>
          <div class="tab-item">Projects & Resources</div>
        </div>
      </div>

      <!-- Tab Content (Description) -->
      <div class="content-card"
        style="background: #1e293b; border: 1px solid #334155; padding: var(--spacing-2xl); border-radius: var(--radius-2xl);">
        <p class="course-description"
          style="color: var(--gray-400); line-height: 1.8; font-size: var(--font-size-base); margin: 0;">
          {{ course.description }}
        </p>
      </div>
    </div>

    <!-- Sidebar -->
    <div class="course-sidebar">
      <!-- Course Completion Card -->
      <div class="sidebar-card">
        <h3 class="sidebar-card-title">Course Completion</h3>
        {% if enrollment %}
        <div class="progress-info"
          style="display: flex; justify-content: space-between; margin-bottom: var(--spacing-sm); font-size: var(--font-size-sm); font-weight: 700;">
          <span style="color: var(--primary);">{{ progress_percentage }}% complete</span>
          <span style="color: var(--text-muted);">1/{{ modules|length }}</span>
        </div>
        <div class="progress-bar-container"
          style="height: 10px; background: #0f172a; border-radius: var(--radius-full); overflow: hidden; margin-bottom: var(--spacing-xl); border: 1px solid #334155;">
          <div class="progress-bar-fill"
            style="height: 100%; width: {{ progress_percentage }}%; background: var(--primary); border-radius: var(--radius-full); box-shadow: 0 0 10px rgba(212, 175, 55, 0.3);">
          </div>
        </div>
        {% else %}
        <p style="color: var(--text-muted); font-size: var(--font-size-sm); margin-bottom: var(--spacing-lg);">Enroll to
          track your progress and access all modules.</p>
        {% endif %}

        <!-- Module Timeline -->
        <div class="module-timeline">
          {% for module in modules %}
          <a href="{% if enrollment %}{% url 'course_viewer' enrollment.id %}?module_id={{ module.id }}{% else %}#{% endif %}"
            class="timeline-item {% if forloop.first %}active{% endif %}">
            <div class="timeline-dot">
              {{ forloop.counter|stringformat:"02d" }}
            </div>
            <div class="timeline-content">
              <div class="timeline-title">{{ module.title }}</div>
              <div class="timeline-meta">
                <div class="timeline-duration">
                  <span class="material-icons" style="font-size: 14px;">schedule</span>
                  <span>01:41</span>
                </div>
                <div class="timeline-status">
                  <span class="material-icons">
                    {% if module.content_type == 'video' %}play_circle
                    {% elif module.content_type == 'code' %}code
                    {% else %}article{% endif %}
                  </span>
                </div>
              </div>
            </div>
          </a>
          {% endfor %}
        </div>
      </div>

      <!-- Share Card -->
      <div class="sidebar-card">
        <h3 class="sidebar-card-title" style="margin-bottom: var(--spacing-lg); font-size: var(--font-size-lg);">Share
        </h3>
        <div style="display: flex; gap: var(--spacing-md);">
          <button class="btn btn-secondary btn-sm"
            style="flex: 1; border-radius: var(--radius-lg); background: #0f172a; color: white; border: 1px solid #334155;"><span
              class="material-icons" style="font-size: 20px;">link</span></button>
          <button class="btn btn-secondary btn-sm"
            style="flex: 1; border-radius: var(--radius-lg); background: #0f172a; color: white; border: 1px solid #334155;"><span
              class="material-icons" style="font-size: 20px;">public</span></button>
          <button class="btn btn-secondary btn-sm"
            style="flex: 1; border-radius: var(--radius-lg); background: #0f172a; color: white; border: 1px solid #334155;"><span
              class="material-icons" style="font-size: 20px;">facebook</span></button>
          <button class="btn btn-secondary btn-sm"
            style="flex: 1; border-radius: var(--radius-lg); background: #0f172a; color: white; border: 1px solid #334155;"><span
              class="material-icons" style="font-size: 20px;">more_horiz</span></button>
        </div>
      </div>

      <!-- Enrollment Action -->
      {% if not enrollment %}
      <div class="enrollment-action-card">
        <span class="price-tag">Rp {{ course.price|rupiah }}</span>
        <a href="{% url 'payment' course.id %}" class="btn btn-primary">
          <span class="material-icons">shopping_cart</span>
          <span>Enroll Now</span>
        </a>
      </div>
      {% else %}
      <div class="enrollment-action-card">
        <a href="{% url 'course_viewer' enrollment.id %}" class="btn btn-primary">
          <span class="material-icons">play_arrow</span>
          <span>Continue Learning</span>
        </a>
      </div>
      {% endif %}
    </div>
  </div>
</div>
{% endblock %}