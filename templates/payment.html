{% extends 'base.html' %}

{% block title %}Payment - {{ course.title }}{% endblock %}

{% block content %}
<div class="container py-4">
  <div style="max-width: 600px; margin: 0 auto;">
    <h1 class="text-center mb-4" style="font-size: var(--font-size-2xl); font-weight: 600;">
      Complete Your Enrollment
    </h1>

    <div class="card mb-4">
      <div class="card-body">
        <h3 style="margin-bottom: var(--spacing-lg);">{{ course.title }}</h3>
        <div class="price" style="margin-bottom: var(--spacing-md);">${{ course.price }}</div>
        <p style="color: var(--gray-600);">{{ course.description|truncatewords:30 }}</p>
      </div>
    </div>

    <div class="card mb-4">
      <div class="card-body">
        <h3 style="display: flex; align-items: center; gap: var(--spacing-sm); margin-bottom: var(--spacing-lg);">
          <span class="material-icons">payment</span>
          <span>Payment (Demo Mode)</span>
        </h3>

        <div
          style="background: var(--primary-light); padding: var(--spacing-md); border-radius: var(--radius-md); margin-bottom: var(--spacing-lg);">
          <div style="display: flex; align-items: center; gap: var(--spacing-sm); color: var(--primary-dark);">
            <span class="material-icons">info</span>
            <span>This is demo mode. No actual payment will be processed.</span>
          </div>
        </div>
      </div>
    </div>

    <div class="card">
      <div class="card-body">
        <h3 style="display: flex; align-items: center; gap: var(--spacing-sm); margin-bottom: var(--spacing-lg);">
          <span class="material-icons">person</span>
          <span>{% if user.is_authenticated %}Confirm Enrollment{% else %}Create Account &amp; Complete Payment{% endif %}</span>
        </h3>

        <form method="post">
          {% csrf_token %}

          {% if not user.is_authenticated %}
          <div class="form-group">
            <label class="form-label">Username *</label>
            <input type="text" name="username" class="form-input" required>
          </div>

          <div class="form-group">
            <label class="form-label">Email *</label>
            <input type="email" name="email" class="form-input" required>
            <small style="color: var(--gray-600); display: block; margin-top: var(--spacing-xs);">
              Your course access key will be sent to this email
            </small>
          </div>

          <div class="form-group">
            <label class="form-label">Password *</label>
            <input type="password" name="password1" class="form-input" required>
          </div>

          <div class="form-group">
            <label class="form-label">Confirm Password *</label>
            <input type="password" name="password2" class="form-input" required>
          </div>

          <div class="form-group">
            <label class="form-label">First Name *</label>
            <input type="text" name="first_name" class="form-input" required>
          </div>

          <div class="form-group">
            <label class="form-label">Last Name *</label>
            <input type="text" name="last_name" class="form-input" required>
          </div>

          <div class="form-group">
            <label class="form-label">Phone</label>
            <input type="text" name="phone" class="form-input">
          </div>
          {% else %}
          <div
            style="background: var(--gray-50); padding: var(--spacing-md); border-radius: var(--radius-md); margin-bottom: var(--spacing-lg); border: 1px solid var(--gray-200);">
            <p style="margin-bottom: var(--spacing-xs); font-weight: 500;">Enrolling as:</p>
            <div style="display: flex; align-items: center; gap: var(--spacing-sm);">
              <div
                style="width: 40px; height: 40px; background: var(--primary); color: white; border-radius: 50%; display: flex; align-items: center; justify-content: center; font-weight: 600;">
                {{ user.username|first|upper }}
              </div>
              <div>
                <div style="font-weight: 600;">{{ user.get_full_name|default:user.username }}</div>
                <div style="font-size: var(--font-size-sm); color: var(--gray-600);">{{ user.email }}</div>
              </div>
            </div>
          </div>
          <p style="color: var(--gray-600); margin-bottom: var(--spacing-lg);">
            Your course access key will be sent to <strong>{{ user.email }}</strong>.
          </p>
          {% endif %}

          <button type="submit" class="btn btn-primary btn-lg" style="width: 100%; justify-content: center;">
            <span class="material-icons">check_circle</span>
            <span>{% if user.is_authenticated %}Complete Enrollment{% else %}Create Account &amp; Enroll{% endif %}</span>
          </button>
        </form>
      </div>
    </div>

    {% if not user.is_authenticated %}
    <div style="text-align: center; margin-top: var(--spacing-lg);">
      <p style="color: var(--gray-600);">
        Already have an account?
        <a href="{% url 'login' %}?next={% url 'payment' course.id %}"
          style="color: var(--primary); text-decoration: none; font-weight: 500;">Login here</a>
      </p>
    </div>
    {% endif %}
  </div>
</div>
{% endblock %}
