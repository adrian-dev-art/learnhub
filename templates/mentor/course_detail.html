{% extends 'shared/base.html' %}
{% load static %}

{% block title %}Manage Course: {{ course.title }} - LearningApp{% endblock %}

{% block content %}
<div class="container">
  <div class="breadcrumb"
    style="display: flex; align-items: center; gap: 4px; font-size: var(--font-size-xs); color: var(--text-muted); margin-bottom: var(--spacing-lg);">
    <a href="{% url 'mentor_dashboard' %}"
      style="color: var(--primary); text-decoration: none; font-weight: 600;">Dashboard</a>
    <span class="material-icons" style="font-size: 14px;">chevron_right</span>
    <span>{{ course.title }}</span>
  </div>

  <div class="card-header-premium" style="justify-content: space-between; margin-bottom: var(--spacing-2xl);">
    <div class="header-info">
      <h1 class="course-title" style="margin-bottom: var(--spacing-sm);">{{ course.title }}</h1>
      <div class="badge-group">
        <span class="badge-premium">{{ course.get_level_display }}</span>
        <span class="badge-premium">
          <span class="material-icons" style="font-size: 16px;">group</span>
          {{ enrollments.count }} Students
        </span>
        <span class="badge-premium">
          <span class="material-icons" style="font-size: 16px;">library_books</span>
          {{ modules.count }} Modules
        </span>
      </div>
    </div>
    <div class="header-actions" style="display: flex; gap: var(--spacing-sm);">
      <a href="{% url 'mentor_course_edit' course.id %}" class="btn-preview">
        <span class="material-icons">edit</span>
        <span>Edit</span>
      </a>
      <a href="{% url 'mentor_course_import_doc' course.id %}" class="btn-preview">
        <span class="material-icons">file_upload</span>
        <span>Import</span>
      </a>
      <a href="{% url 'mentor_module_add' course.id %}" class="btn-primary-premium"
        style="width: auto; padding: var(--spacing-sm) var(--spacing-lg);">
        <span class="material-icons">add</span>
        <span>Add Module</span>
      </a>
    </div>
  </div>

  <div class="course-header-grid">
    <!-- Modules Section -->
    <div class="management-section">
      <div class="content-card">
        <div class="card-header-premium">
          <span class="material-icons">view_list</span>
          <h2>Course Curriculum</h2>
        </div>

        <div class="module-list-premium">
          {% for module in modules %}
          <div class="module-item-premium">
            <div class="module-icon">
              <span class="material-icons">
                {% if module.content_type == 'assessment' %}assignment
                {% else %}description{% endif %}
              </span>
            </div>
            <div class="module-details">
              <div class="module-title">{{ module.title }}</div>
              <div class="module-meta" style="font-size: var(--font-size-xs); color: var(--text-muted);">{{
                module.get_content_type_display }} â€¢ Order: {{ module.order }}</div>
            </div>
            <div class="module-actions" style="display: flex; gap: 8px;">
              <a href="{% url 'mentor_module_edit' module.id %}" class="btn-preview" title="Edit">
                <span class="material-icons" style="font-size: 18px;">edit</span>
              </a>
            </div>
          </div>
          {% empty %}
          <div style="text-align: center; padding: var(--spacing-2xl); color: var(--text-muted);">
            <span class="material-icons" style="font-size: 48px;">post_add</span>
            <p>No modules added yet.</p>
          </div>
          {% endfor %}
        </div>
      </div>
    </div>

    <!-- Students Section -->
    <div class="students-section">
      <div class="content-card">
        <div class="card-header-premium">
          <span class="material-icons">group</span>
          <h2>Enrolled Students</h2>
        </div>

        <div class="student-list" style="display: flex; flex-direction: column; gap: var(--spacing-md);">
          {% for enrollment in enrollments %}
          <div
            style="display: flex; align-items: center; gap: var(--spacing-md); padding: var(--spacing-md); background: var(--gray-50); border-radius: var(--radius-lg); border: 1px solid var(--border-color);">
            <div
              style="width: 40px; height: 40px; background: var(--primary-light); color: var(--primary); border-radius: 50%; display: flex; align-items: center; justify-content: center; font-weight: 700; font-size: 14px;">
              {{ enrollment.user.first_name|first }}{{ enrollment.user.last_name|first }}
            </div>
            <div style="flex: 1;">
              <div style="font-weight: 600; color: var(--text-main); font-size: 14px;">{{ enrollment.user.get_full_name
                }}</div>
              <div class="progress-bar-container" style="height: 6px; margin-top: 4px;">
                <div class="progress-bar-fill" style="--progress: {{ enrollment.calculated_progress }}%"></div>
              </div>
              <div style="font-size: 10px; color: var(--text-muted); margin-top: 2px;">{{ enrollment.calculated_progress
                }}% Complete</div>
            </div>
            <div class="status-badge">
              {% if enrollment.completed %}
              <span class="badge-success-premium" style="font-size: 10px; padding: 2px 8px;">Finished</span>
              {% else %}
              <span class="badge-premium"
                style="font-size: 10px; padding: 2px 8px; background: #fff7ed; color: #ea580c;">In Progress</span>
              {% endif %}
            </div>
          </div>
          {% empty %}
          <div style="text-align: center; padding: var(--spacing-2xl); color: var(--text-muted);">
            <span class="material-icons" style="font-size: 48px;">person_off</span>
            <p>No students enrolled yet.</p>
          </div>
          {% endfor %}
        </div>
      </div>
    </div>
  </div>
</div>
{% endblock %}
